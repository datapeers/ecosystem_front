<ng-container *ngIf="loaded; else loadingTemplate">
    <div class="p-4">
        <div class="w-full flex flex-row w-full gap-4 text-white justify-content-between align-items-center ">
            <h2>Eventos</h2>
            <div class="flex flex-row gap-2">
                <!-- <p-button label="Vista previa" icon="pi pi-eye"></p-button> -->
                <p-button label="Tipos de eventos" icon="pi pi-tags" (onClick)="showTypes = true"></p-button>
                <p-button label="Evento" icon="pi pi-plus" (onClick)="showCreatorEvent = true"></p-button>
            </div>
        </div>
    </div>
</ng-container>
<ng-template #loadingTemplate>
    <app-loading></app-loading>
</ng-template>

<p-dialog header="Tipo eventos" [(visible)]="showTypes" [style]="{ width: '50vw', height: '50vh' }" [draggable]="false" [resizable]="false">
    <!-- <div class="w-full flex flex-row justify-content-end">
        <p-button type="button" label="Etapa" icon="pi pi-plus" (onClick)="createStage()"></p-button>
    </div> -->
    <p-table [value]="typesEvents" dataKey="_id" editMode="row" [tableStyle]="{'min-width': '45rem'}">
        <ng-template pTemplate="header">
            <tr>
                <th style="width:25%">Nombre</th>
                <th style="width:25%">Permite acta</th>
                <th style="width:25%">Permite archivos</th>
                <th style="width:25%">
                    <button pButton pRipple type="button" icon="pi pi-plus" class="p-button-rounded p-button-text mr-2" [pTooltip]="'Agregar tipo'" (click)="showCreatorType = true;"></button>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-typeEvent let-editing="editing" let-ri="rowIndex">
            <tr [pEditableRow]="typeEvent">
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <input pInputText type="text" [(ngModel)]="typeEvent.name" required>
                        </ng-template>
                        <ng-template pTemplate="output">
                            {{typeEvent.name}}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-checkbox [binary]="true" [(ngModel)]="typeEvent.extra_options.allow_acta" inputId="allowActa"></p-checkbox>
                        </ng-template>
                        <ng-template pTemplate="output">
                            <p-checkbox [binary]="true" [(ngModel)]="typeEvent.extra_options.allow_acta" [disabled]="true"></p-checkbox>
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template pTemplate="input">
                            <p-checkbox [binary]="true" [(ngModel)]="typeEvent.extra_options.allow_files" inputId="allowFiles"></p-checkbox>
                        </ng-template>
                        <ng-template pTemplate="output">
                            <p-checkbox [binary]="true" [(ngModel)]="typeEvent.extra_options.allow_files" [disabled]="true"></p-checkbox>
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <div class="flex align-items-center justify-content-center gap-2">
                        <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="onTypeEventEditInit(typeEvent)" class="p-button-rounded p-button-text"></button>
                        <button *ngIf="!editing" pButton pRipple type="button" icon="pi pi-trash" (click)="deleteType(typeEvent, ri)" class="p-button-rounded p-button-text"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onTypeEventEditSave(typeEvent, ri)" class="p-button-rounded p-button-text p-button-success mr-2"></button>
                        <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" (click)="onTypeEventEditCancel(typeEvent, ri)" class="p-button-rounded p-button-text p-button-danger"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-dialog>


<p-dialog header="Crear tipo eventos" [(visible)]="showCreatorType" [style]="{ width: '50vw', height: '30vh' }" [draggable]="false" [resizable]="false" [modal]="true" (onHide)="resetCreatorEventType()">
    <div class="flex flex-column gap-2 py-2">
        <input pInputText type="text" [(ngModel)]="newTypeEvent.name" placeholder="Nombre" required>
        <p-checkbox [binary]="true" [(ngModel)]="newTypeEvent.extra_options.allow_acta" label="Permite acta" inputId="allowActa"></p-checkbox>
        <p-checkbox [binary]="true" [(ngModel)]="newTypeEvent.extra_options.allow_files" label="Permite archivos" inputId="allowFiles"></p-checkbox>
        <div style="height: 1rem;"></div>
        <p-button type="submit" label="Crear" (onClick)="createTypeEvent()" [disabled]="newTypeEvent.name === ''" styleClass="p-button-lg w-full border-round-2xl my-2 p-3 bg-primary"></p-button>
    </div>
</p-dialog>


<p-dialog header="Crear evento" [(visible)]="showCreatorEvent" [style]="{ width: '80vw', height: '70vh' }" [draggable]="false" [resizable]="false" [modal]="true" (onHide)="resetCreatorEvent()">
    <div class="formgrid grid">
        <div style="height: 1rem;"></div>
        <div class="field col-12 md:col-6 pt-4">
            <div class="p-inputgroup">
                <span class="p-inputgroup-addon">
                    <i class="pi pi-id-card"></i>
                </span>
                <span class="p-float-label">
                    <input pInputText type="text" [(ngModel)]="newEvent.name" placeholder="Nombre" required>
                    <label for="name">Nombre</label>
                </span>
            </div>
        </div>

        <div class="field col-12 md:col-6 pt-4">
            <div class="flex">
                <span class="p-inputgroup-addon">
                    <i class="pi pi-list"></i>
                </span>
                <span class="p-float-label" style="width: 100%">
                    <p-dropdown inputId="typeEvent" [autoDisplayFirst]="true" [options]="typesEvents" optionLabel="name" appendTo="body" optionValue="_id" [style]="{ width: '100%' }" [(ngModel)]="newEvent.type">
                    </p-dropdown>
                    <label for="typeEvent">Tipo Evento</label>
                </span>
            </div>
        </div>

        <div class="field col-6 pt-3 md:col-6">
            <div class="flex">
                <span class="p-inputgroup-addon">
                    <i class="pi pi-calendar-times"></i>
                </span>
                <span class="p-float-label" style="width: 100%">
                    <p-calendar inputId="calendar-first" [readonlyInput]="true" appendTo="body" [style]="{ width: '100%' }" [(ngModel)]="newEvent.startAt" [showTime]="true"></p-calendar>
                    <label for="calendar-first">Inicia</label>
                </span>
            </div>
        </div>

        <div class="field col-6 pt-3 md:col-6">
            <div class="flex">
                <span class="p-inputgroup-addon">
                    <i class="pi pi-calendar-times"></i>
                </span>
                <span class="p-float-label" style="width: 100%">
                    <p-calendar inputId="calendar-first" [readonlyInput]="true" appendTo="body" [style]="{ width: '100%' }" [(ngModel)]="newEvent.endAt" [showTime]="true"></p-calendar>
                    <label for="calendar-first">Termina</label>
                </span>
            </div>
        </div>

        <div style="height: 1rem;"></div>
        <p-button type="submit" label="Crear" (onClick)="createTypeEvent()" [disabled]="newTypeEvent.name === ''" styleClass=" field col-12  p-button-lg w-full border-round-2xl my-2 p-3 bg-primary"></p-button>
    </div>
</p-dialog>

<p-confirmDialog key="confirmDialog" [style]="{ width: '50vw' }"></p-confirmDialog>